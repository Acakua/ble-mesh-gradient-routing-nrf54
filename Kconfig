#
# Copyright (c) 2020 Nordic Semiconductor
#
# SPDX-License-Identifier: LicenseRef-Nordic-5-Clause
#

source "Kconfig.zephyr"

menu "Nordic Bluetooth Mesh chat client sample"

config BT_MESH_GRADIENT_SRV_FORWARDING_TABLE_SIZE
    int "Forwarding table size"
    default 15
    range 1 255
    help
      Maximum number of entries in the forwarding table.
      Each entry contains address, RSSI, and gradient information
      for routing decisions. Larger values provide more routing
      options but consume more memory.

config BT_MESH_GRADIENT_SRV_MESSAGE_LENGTH
    int "Max length of the message to be sent over mesh"
    default 40
    range 0 255
    help
      Impacts on memory size occupied by the buffer of a message to be
      published. This does not include null terminator. The message must also
      fit into the application SDU. Adjust BT_MESH_TX_SEG_MAX and
      BT_MESH_RX_SEG_MAX to be able to receive the longest messages.

config BT_MESH_CHAT_SAMPLE_PRESENCE_CACHE_SIZE
    int "Presence cache size"
    default 10
    range 0 32767
    help
      Presence cache stores previously received presence of chat clients.
      Recommended to be as big as number of chat clients in the mesh network.

config BT_MESH_GRADIENT_SINK_NODE
    bool "Configure this node as sink node"
    default n
    help
      If enabled, this node will be configured as the sink node
      (gradient = 0) in the gradient routing protocol.
      Only ONE node in the network should have this enabled.

config BT_MESH_GRADIENT_SRV_HEARTBEAT_ENABLED
    bool "Enable heartbeat mechanism for route maintenance"
    default y
    help
      When enabled, each node (except Gateway) will periodically send
      a heartbeat DATA packet to maintain its route in the reverse
      routing tables of upstream nodes and Gateway.
      
      This ensures Gateway can always send BACKPROP_DATA to any node,
      even if that node hasn't sent real data recently.

config BT_MESH_GRADIENT_SRV_HEARTBEAT_INTERVAL_SEC
    int "Heartbeat maintenance interval in seconds (Stable state)"
    default 3600
    range 10 7200
    depends on BT_MESH_GRADIENT_SRV_HEARTBEAT_ENABLED
    help
      The interval between heartbeats when the network is STABLE (Maintenance Mode).
      
      The system uses an Adaptive Heartbeat mechanism:
      1. Starts FAST (5s) when joining or changing parent.
      2. Slows down gradually (10s -> 20s).
      3. Finally settles at THIS value (default 3600s = 1 hour).
      
      Note: This value must be significantly smaller than RRT_TIMEOUT_SEC.

config BT_MESH_GRADIENT_SRV_RRT_TIMEOUT_SEC
    int "Reverse routing table entry timeout in seconds"
    default 7200
    range 60 20000
    help
      How long a reverse route entry stays valid without being refreshed.
      
      When a node sends DATA (including heartbeat), the route to that node
      is refreshed. If no DATA is received from a node within this timeout,
      the route entry will be removed.
      
      Recommended: At least 2x HEARTBEAT_INTERVAL_SEC.
      Default 7200s (2 hours) allows a node in Maintenance Mode (1 hour)
      to miss one heartbeat packet without losing connectivity.

config BT_MESH_GRADIENT_SRV_RRT_MAX_DEST
    int "Max reverse routes per neighbor"
    default 45
    range 5 500
    help
      Maximum number of destination nodes that can be stored in the 
      Reverse Routing Table for a single immediate neighbor.
      
      For the Gateway (Sink Node), this value should be at least equal 
      to the total number of nodes in the network, as one neighbor 
      might be the next-hop for all other nodes.
      
      Impact: Higher values consume more heap memory (approx 16 bytes per entry).

endmenu

module = bt_mesh_gradient_srv
module-str = BT Mesh Chat Client model
source "${ZEPHYR_BASE}/subsys/logging/Kconfig.template.log_config"